<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard E-Katalog Sumber Daya Air</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Segoe UI', sans-serif; }
        .leaflet-container { height: 100%; width: 100%; border-radius: 0.5rem; }
        .info-panel { padding: 8px 12px; background: rgba(255, 255, 255, 0.9); box-shadow: 0 0 15px rgba(0,0,0,0.2); border-radius: 5px; }
        .info-panel h4 { margin: 0 0 5px 0; color: #333; font-weight: 600; }
        .legend { line-height: 18px; color: #555; }
        .legend i { width: 18px; height: 18px; float: left; margin-right: 8px; opacity: 0.8; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 10px; }
        .modal-container { z-index: 1000; }
        .toast-notification { z-index: 1100; transition: opacity 0.5s, transform 0.5s; }
        .pagination-btn:disabled { cursor: not-allowed; background-color: #d1d5db; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="flex h-screen">
        <!-- Sidebar -->
        <aside class="w-64 bg-white shadow-lg flex flex-col">
            <div class="p-4 border-b">
                <h1 class="text-xl font-bold text-gray-700">E-Katalog SDA</h1>
                <p class="text-xs text-gray-500">Dashboard Monitoring</p>
            </div>
            <nav class="flex-1 p-4 space-y-2">
                <a href="#" class="flex items-center p-2 text-base rounded-lg bg-gray-200"><svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg><span class="ml-3">Dashboard</span></a>
                <a href="#" onclick="openModal('marketSoundingModal')" class="flex items-center p-2 text-base rounded-lg hover:bg-gray-100"><svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg><span class="ml-3">Input Market Sounding</span></a>
                <a href="#" onclick="openModal('historyModal')" class="flex items-center p-2 text-base rounded-lg hover:bg-gray-100"><svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span class="ml-3">Histori Market Sounding</span></a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-6 overflow-y-auto">
            <header class="mb-6">
                <h2 class="text-2xl font-semibold text-gray-700">Dashboard Analitik Produk</h2>
                <div class="mt-2 p-4 bg-white rounded-lg shadow">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Analisis Market Sounding</h3>
                    <div class="flex flex-col md:flex-row gap-4 items-center">
                        <div class="flex-1"><label for="comparisonDate" class="block text-sm font-medium">Pilih Event</label><select id="comparisonDate" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"><option value="latest">Tampilkan Data Terkini</option></select></div>
                        <div class="flex-1"><label for="comparisonDay" class="block text-sm font-medium">Analisis Perubahan (H+)</label><input type="number" id="comparisonDay" value="7" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></div>
                        <button onclick="runComparison()" class="w-full md:w-auto mt-4 md:mt-0 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">Jalankan Analisis</button>
                    </div>
                </div>
                <div class="mt-4 p-4 bg-white rounded-lg shadow">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div><label for="filterProvinsi" class="block text-sm font-medium">Provinsi</label><select id="filterProvinsi" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"><option value="all">Semua Provinsi</option></select></div>
                        <div><label for="filterKategori1" class="block text-sm font-medium">Kategori 1</label><select id="filterKategori1" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"><option value="all">Semua Kategori 1</option></select></div>
                        <div><label for="filterKategori2" class="block text-sm font-medium">Kategori 2</label><select id="filterKategori2" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"><option value="all">Semua Kategori 2</option></select></div>
                        <div><label for="filterProduk" class="block text-sm font-medium">Nama Produk</label><select id="filterProduk" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"><option value="all">Semua Produk</option></select></div>
                    </div>
                </div>
            </header>
            <div id="stats-cards" class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"></div>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                <div class="lg:col-span-2 bg-white p-4 rounded-lg shadow h-[60vh] overflow-hidden"><h3 class="font-semibold mb-2">Persebaran Produk di Indonesia</h3><div id="map" class="h-full w-full"></div></div>
                <div class="bg-white p-4 rounded-lg shadow h-[60vh]"><h3 class="font-semibold mb-2">Produk per Kategori</h3><canvas id="categoryChart"></canvas></div>
            </div>
            <div class="bg-white p-4 rounded-lg shadow">
                <h3 class="font-semibold mb-2">Detail Produk</h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left text-xs font-medium uppercase">Nama Produk</th><th class="px-6 py-3 text-left text-xs font-medium uppercase">Perusahaan</th></tr></thead>
                        <tbody id="filteredTableBody" class="bg-white divide-y"></tbody>
                    </table>
                </div>
                <!-- Pagination Controls -->
                <div id="pagination-controls" class="flex justify-between items-center mt-4 px-2"></div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div id="marketSoundingModal" class="modal-container fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center"><div class="bg-white rounded-lg shadow-xl w-full max-w-md p-6"><h2 class="text-xl font-bold mb-4">Catat Market Sounding</h2><form id="marketSoundingForm"><div class="mb-4"><label for="balai" class="block text-sm">Balai</label><input type="text" id="balai" class="mt-1 block w-full" required></div><div class="mb-4"><label for="provinsi" class="block text-sm">Wilayah</label><select id="provinsi" class="mt-1 block w-full" required></select></div><div class="mb-4"><label for="paket_pekerjaan" class="block text-sm">Paket Pekerjaan</label><input type="text" id="paket_pekerjaan" class="mt-1 block w-full" required></div><div class="mb-4"><label for="tanggal" class="block text-sm">Tanggal</label><input type="date" id="tanggal" class="mt-1 block w-full" required></div><div class="flex justify-end space-x-2"><button type="button" onclick="closeModal('marketSoundingModal')" class="px-4 py-2 bg-gray-200 rounded-md">Batal</button><button type="submit" id="submit-btn" class="px-4 py-2 bg-blue-600 text-white rounded-md">Simpan</button></div></form></div></div>
    <div id="historyModal" class="modal-container fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center"><div class="bg-white rounded-lg shadow-xl w-full max-w-5xl p-6"><div class="flex justify-between items-center mb-4"><h2 class="text-xl font-bold">Histori Market Sounding</h2><button type="button" onclick="closeModal('historyModal')" class="text-gray-400"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div><div class="overflow-y-auto max-h-[70vh]"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left text-xs uppercase">Tanggal</th><th class="px-6 py-3 text-left text-xs uppercase">Balai</th><th class="px-6 py-3 text-left text-xs uppercase">Wilayah</th><th class="px-6 py-3 text-left text-xs uppercase">Paket Pekerjaan</th><th class="px-6 py-3 text-left text-xs uppercase">Aksi</th></tr></thead><tbody id="historyTableBody" class="bg-white divide-y"></tbody></table></div></div></div>
    <div id="analysisResultModal" class="modal-container fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center"><div class="bg-white rounded-lg shadow-xl w-full max-w-2xl p-6"><div class="flex justify-between items-center mb-4"><h2 class="text-xl font-bold">Hasil Perbandingan</h2><button type="button" onclick="closeModal('analysisResultModal')" class="text-gray-400"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div><div id="comparison-content" class="overflow-y-auto max-h-[70vh]"></div></div></div>
    <div id="deleteConfirmationModal" class="modal-container fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center"><div class="bg-white rounded-lg shadow-xl w-full max-w-md p-6 text-center"><svg class="mx-auto mb-4 text-gray-400 w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg><h3 class="mb-5 text-lg">Anda yakin ingin menghapus event ini?</h3><p id="deleteEventDetails" class="mb-5 text-sm text-gray-500"></p><button id="confirmDeleteBtn" class="text-white bg-red-600 hover:bg-red-800 rounded-lg px-5 py-2.5 mr-2">Ya, Hapus</button><button onclick="closeModal('deleteConfirmationModal')" class="text-gray-500 bg-white hover:bg-gray-100 rounded-lg border px-5 py-2.5">Batal</button></div></div>
    <div id="toast-notification" class="toast-notification fixed top-5 right-5 bg-green-500 text-white px-6 py-3 rounded-lg opacity-0 transform translate-y-[-20px]"></div>

    </body>
    
    <script>
        // --- GLOBAL VARIABLES & CONFIGURATION ---
        const API_URL = "https://script.google.com/macros/s/AKfycbxGIlUNHm_9qm11g0sFnW8_N67mdLNsjRDWDn8uewmyJ6pX1HYWLVoiVR-ifkCxM4PL/exec";
        let marketSoundingLog = [];
        let latestProducts = [];
        let filteredProducts = []; // NEW: Will hold the currently filtered data
        let currentPage = 1;
        const ITEMS_PER_PAGE = 10; // Items per page for pagination
        
        const indonesiaGeoJson = { "type": "FeatureCollection", "features": [{ "type": "Feature", "properties": { "name": "ACEH" }, "geometry": { "type": "Point", "coordinates": [96.92, 4.22] } }, { "type": "Feature", "properties": { "name": "SUMATERA UTARA" }, "geometry": { "type": "Point", "coordinates": [99.5, 2.5] } }, { "type": "Feature", "properties": { "name": "SUMATERA BARAT" }, "geometry": { "type": "Point", "coordinates": [100.47, -0.74] } }, { "type": "Feature", "properties": { "name": "RIAU" }, "geometry": { "type": "Point", "coordinates": [101.69, 0.51] } }, { "type": "Feature", "properties": { "name": "JAMBI" }, "geometry": { "type": "Point", "coordinates": [102.73, -1.61] } }, { "type": "Feature", "properties": { "name": "SUMATERA SELATAN" }, "geometry": { "type": "Point", "coordinates": [104.09, -3.32] } }, { "type": "Feature", "properties": { "name": "BENGKULU" }, "geometry": { "type": "Point", "coordinates": [102.34, -3.8] } }, { "type": "Feature", "properties": { "name": "LAMPUNG" }, "geometry": { "type": "Point", "coordinates": [105.02, -4.89] } }, { "type": "Feature", "properties": { "name": "KEPULAUAN BANGKA BELITUNG" }, "geometry": { "type": "Point", "coordinates": [106.51, -2.74] } }, { "type": "Feature", "properties": { "name": "KEPULAUAN RIAU" }, "geometry": { "type": "Point", "coordinates": [104.51, 0.92] } }, { "type": "Feature", "properties": { "name": "DKI JAKARTA" }, "geometry": { "type": "Point", "coordinates": [106.82, -6.21] } }, { "type": "Feature", "properties": { "name": "JAWA BARAT" }, "geometry": { "type": "Point", "coordinates": [107.62, -6.92] } }, { "type": "Feature", "properties": { "name": "JAWA TENGAH" }, "geometry": { "type": "Point", "coordinates": [110.2, -7.26] } }, { "type": "Feature", "properties": { "name": "DAERAH ISTIMEWA YOGYAKARTA" }, "geometry": { "type": "Point", "coordinates": [110.45, -7.87] } }, { "type": "Feature", "properties": { "name": "JAWA TIMUR" }, "geometry": { "type": "Point", "coordinates": [112.73, -7.54] } }, { "type": "Feature", "properties": { "name": "BANTEN" }, "geometry": { "type": "Point", "coordinates": [106.15, -6.44] } }, { "type": "Feature", "properties": { "name": "BALI" }, "geometry": { "type": "Point", "coordinates": [115.19, -8.41] } }, { "type": "Feature", "properties": { "name": "NUSA TENGGARA BARAT" }, "geometry": { "type": "Point", "coordinates": [117.56, -8.65] } }, { "type": "Feature", "properties": { "name": "NUSA TENGGARA TIMUR" }, "geometry": { "type": "Point", "coordinates": [121.08, -8.68] } }, { "type": "Feature", "properties": { "name": "KALIMANTAN BARAT" }, "geometry": { "type": "Point", "coordinates": [111.12, -0.02] } }, { "type": "Feature", "properties": { "name": "KALIMANTAN TENGAH" }, "geometry": { "type": "Point", "coordinates": [113.28, -1.69] } }, { "type": "Feature", "properties": { "name": "KALIMANTAN SELATAN" }, "geometry": { "type": "Point", "coordinates": [115.45, -3.09] } }, { "type": "Feature", "properties": { "name": "KALIMANTAN TIMUR" }, "geometry": { "type": "Point", "coordinates": [116.42, 0.58] } }, { "type": "Feature", "properties": { "name": "KALIMANTAN UTARA" }, "geometry": { "type": "Point", "coordinates": [116.47, 3.08] } }, { "type": "Feature", "properties": { "name": "SULAWESI UTARA" }, "geometry": { "type": "Point", "coordinates": [124.57, 1.34] } }, { "type": "Feature", "properties": { "name": "SULAWESI TENGAH" }, "geometry": { "type": "Point", "coordinates": [121.2, -1.4] } }, { "type": "Feature", "properties": { "name": "SULAWESI SELATAN" }, "geometry": { "type": "Point", "coordinates": [120.16, -4.14] } }, { "type": "Feature", "properties": { "name": "SULAWESI TENGGARA" }, "geometry": { "type": "Point", "coordinates": [122.07, -4.14] } }, { "type": "Feature", "properties": { "name": "GORONTALO" }, "geometry": { "type": "Point", "coordinates": [122.45, 0.7] } }, { "type": "Feature", "properties": { "name": "SULAWESI BARAT" }, "geometry": { "type": "Point", "coordinates": [119.35, -2.6] } }, { "type": "Feature", "properties": { "name": "MALUKU" }, "geometry": { "type": "Point", "coordinates": [129.41, -3.24] } }, { "type": "Feature", "properties": { "name": "MALUKU UTARA" }, "geometry": { "type": "Point", "coordinates": [127.53, 0.78] } }, { "type": "Feature", "properties": { "name": "PAPUA BARAT" }, "geometry": { "type": "Point", "coordinates": [132.96, -1.34] } }, { "type": "Feature", "properties": { "name": "PAPUA" }, "geometry": { "type": "Point", "coordinates": [138.8, -4.5] } }, { "type": "Feature", "properties": { "name": "PAPUA TENGAH" }, "geometry": { "type": "Point", "coordinates": [136.2, -4] } }, { "type": "Feature", "properties": { "name": "PAPUA PEGUNUNGAN" }, "geometry": { "type": "Point", "coordinates": [139.5, -4.3] } }, { "type": "Feature", "properties": { "name": "PAPUA SELATAN" }, "geometry": { "type": "Point", "coordinates": [139.5, -7] } }, { "type": "Feature", "properties": { "name": "PAPUA BARAT DAYA" }, "geometry": { "type": "Point", "coordinates": [131.5, -1] } }] };
        const ALL_PROVINCES = indonesiaGeoJson.features.map(f => f.properties.name).sort();
        let map, geojsonLayer, infoPanel = L.control(), legend = L.control({position: 'bottomright'});
        infoPanel.onAdd = function (map) { this._div = L.DomUtil.create('div', 'info-panel'); this.update(); return this._div; };
        infoPanel.update = function (props) { this._div.innerHTML = '<h4>Produk per Provinsi</h4>' + (props ? `<b>${props.name}</b><br />${props.density || 0} produk` : 'Arahkan mouse'); };
        legend.onAdd = function (map) { let div = L.DomUtil.create('div', 'info-panel legend'), g = [0, 10, 50, 100, 200, 500]; for (let i = 0; i < g.length; i++) { div.innerHTML += `<i style="background:${getColor(g[i] + 1)}"></i> ${g[i]}${(g[i + 1] ? '&ndash;' + g[i + 1] + '<br>' : '+')}`; } return div; };
        let categoryChart;

        // --- CORE FUNCTIONS ---
        function initMap() { if (map) map.remove(); map = L.map('map').setView([-2.5, 118], 5); L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager_labels_under/{z}/{x}/{y}{r}.png', { attribution: '&copy; OpenStreetMap &copy; CARTO' }).addTo(map); infoPanel.addTo(map); legend.addTo(map); }
        function initChart() { const canvas = document.getElementById('categoryChart'); if (!canvas) return; const ctx = canvas.getContext('2d'); if(categoryChart) categoryChart.destroy(); categoryChart = new Chart(ctx, { type: 'bar', data: { labels: [], datasets: [{ label: 'Jumlah Produk', data: [], backgroundColor: 'rgba(59, 130, 246, 0.7)' }] }, options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true } }, plugins: { legend: { display: false } } } }); }
        
        // NEW: Tiered sizing and coloring for the map
        function getColor(d) { return d > 500 ? '#800026' : d > 200 ? '#BD0026' : d > 100 ? '#E31A1C' : d > 50 ? '#FC4E2A' : d > 10 ? '#FD8D3C' : d > 0 ? '#FED976' : '#FFFFFF00'; }
        function getRadius(d) { return d > 500 ? 20 : d > 200 ? 16 : d > 100 ? 12 : d > 50 ? 9 : d > 10 ? 7 : d > 0 ? 5 : 0; }

        function updateDashboard(productData) {
            const total = productData.length; const cats = [...new Set(productData.map(p => p.kategori_1))].length;
            document.getElementById('stats-cards').innerHTML = `<div class="bg-white p-4 rounded-lg shadow"><h4 class="text-sm text-gray-500">Total Produk Tampil</h4><p class="text-3xl font-bold">${total}</p></div><div class="bg-white p-4 rounded-lg shadow"><h4 class="text-sm text-gray-500">Kategori Unik</h4><p class="text-3xl font-bold">${cats}</p></div>`;
            
            // Map Update
            if (map) { const counts = productData.reduce((a, p) => { a[p.provinsi] = (a[p.provinsi] || 0) + 1; return a; }, {}); if (geojsonLayer) map.removeLayer(geojsonLayer); geojsonLayer = L.geoJson(indonesiaGeoJson, { style: f => { const c = counts[f.properties.name] || 0; return { fillColor: getColor(c), weight: 1, color: 'white', fillOpacity: 0.7, radius: getRadius(c) }; }, onEachFeature: (f, l) => { l.on({ mouseover: e => { e.target.setStyle({ weight: 3, color: '#666' }); infoPanel.update(e.target.feature.properties); }, mouseout: e => geojsonLayer.resetStyle(e.target) }); const c = counts[f.properties.name] || 0; l.setRadius(getRadius(c)); l.bindPopup(`<b>${f.properties.name}</b><br>${c} produk`); }, pointToLayer: (f, l) => L.circleMarker(l) }).addTo(map); geojsonLayer.eachLayer(l => { l.feature.properties.density = counts[l.feature.properties.name] || 0; }); map.invalidateSize(); }
            
            // Chart Update (with grouping)
            if (categoryChart) { 
                const catCounts = productData.reduce((a, p) => { if(p.kategori_1) a[p.kategori_1] = (a[p.kategori_1] || 0) + 1; return a; }, {}); 
                const sortedCategories = Object.entries(catCounts).sort(([,a],[,b]) => b-a);
                const topCategories = sortedCategories.slice(0, 9);
                const otherCount = sortedCategories.slice(9).reduce((sum, [, count]) => sum + count, 0);
                if (otherCount > 0) { topCategories.push(['Lainnya', otherCount]); }
                categoryChart.data.labels = topCategories.map(item => item[0]); 
                categoryChart.data.datasets[0].data = topCategories.map(item => item[1]); 
                categoryChart.update(); 
            }
        }

        // Table Update (now with pagination)
        function updateFilteredTable() { 
            const tBody = document.getElementById('filteredTableBody');
            tBody.innerHTML = ''; 
            if (filteredProducts.length === 0) { tBody.innerHTML = `<tr><td colspan="2" class="text-center py-4 text-gray-500">Tidak ada data.</td></tr>`; return; } 

            const startIndex = (currentPage - 1) * ITEMS_PER_PAGE;
            const endIndex = startIndex + ITEMS_PER_PAGE;
            const paginatedItems = filteredProducts.slice(startIndex, endIndex);

            paginatedItems.forEach(p => { 
                const row = tBody.insertRow(); 
                row.className = 'hover:bg-gray-50'; 
                row.innerHTML = `<td class="px-6 py-4 text-sm">${p.nama_produk}</td><td class="px-6 py-4 text-sm text-gray-500">${p.perusahaan}</td>`; 
            }); 
        }
        
        // NEW: Render Pagination Controls
        function renderPagination() {
            const controls = document.getElementById('pagination-controls');
            const totalItems = filteredProducts.length;
            if (totalItems <= ITEMS_PER_PAGE) {
                controls.innerHTML = '';
                return;
            }

            const totalPages = Math.ceil(totalItems / ITEMS_PER_PAGE);
            const startIndex = (currentPage - 1) * ITEMS_PER_PAGE + 1;
            const endIndex = Math.min(startIndex + ITEMS_PER_PAGE - 1, totalItems);

            controls.innerHTML = `
                <span class="text-sm text-gray-700">
                    Menampilkan <span class="font-semibold">${startIndex}</span> - <span class="font-semibold">${endIndex}</span> dari <span class="font-semibold">${totalItems}</span> Produk
                </span>
                <div class="inline-flex mt-2 xs:mt-0">
                    <button id="prev-page-btn" class="pagination-btn px-4 py-2 text-sm font-medium text-white bg-gray-800 rounded-l hover:bg-gray-900">
                        Sebelumnya
                    </button>
                    <button id="next-page-btn" class="pagination-btn px-4 py-2 text-sm font-medium text-white bg-gray-800 border-0 border-l border-gray-700 rounded-r hover:bg-gray-900">
                        Berikutnya
                    </button>
                </div>
            `;

            const prevBtn = document.getElementById('prev-page-btn');
            const nextBtn = document.getElementById('next-page-btn');
            
            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage === totalPages;

            prevBtn.addEventListener('click', () => changePage(-1));
            nextBtn.addEventListener('click', () => changePage(1));
        }

        function changePage(direction) {
            currentPage += direction;
            updateFilteredTable();
            renderPagination();
        }
        
        function runComparison() { /* ... kode sama seperti versi sebelumnya ... */ }

        function applyAndRenderFilters() { 
            let data = [...latestProducts]; 
            const filters = { 
                provinsi: document.getElementById('filterProvinsi').value, 
                kategori1: document.getElementById('filterKategori1').value, 
                kategori2: document.getElementById('filterKategori2').value, 
                produk: document.getElementById('filterProduk').value 
            };
            if (filters.provinsi !== 'all') data = data.filter(p => p.provinsi === filters.provinsi); 
            if (filters.kategori1 !== 'all') data = data.filter(p => p.kategori_1 === filters.kategori1); 
            if (filters.kategori2 !== 'all') data = data.filter(p => p.kategori_2 === filters.kategori2); 
            if (filters.produk !== 'all') data = data.filter(p => p.nama_produk === filters.produk); 
            
            filteredProducts = data;
            currentPage = 1;
            
            updateDashboard(filteredProducts); 
            updateFilteredTable();
            renderPagination();
        }
        
        // ... (sisa fungsi JavaScript lainnya tetap sama) ...
        
        async function main() {
            try {
                // ... fetch data ...
                latestProducts = data.latestProducts || [];
                // Initialize filteredProducts after latestProducts is set
                filteredProducts = [...latestProducts]; 
                
                // ... sisa kode ...
                
                // Initial render
                populateFilters(latestProducts, true);
                applyAndRenderFilters();

            } catch (error) { //...
            } finally { //...
            }
        }
        
        document.addEventListener('DOMContentLoaded', main);
    </script>
</html>

